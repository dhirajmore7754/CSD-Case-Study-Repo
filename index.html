<html>

        <head>
                <title>
                        Compliance Monitoring
                </title>



        </head>
        <!--<link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="vendor/datatables/css/jquery.dataTables.css">-->


        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>


        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/r/dt/jq-2.1.4,jszip-2.5.0,pdfmake-0.1.18,dt-1.10.9,af-2.0.0,b-1.0.3,b-colvis-1.0.3,b-html5-1.0.3,b-print-1.0.3,se-1.0.1/datatables.min.css"/>

<script type="text/javascript" src="https://cdn.datatables.net/r/dt/jq-2.1.4,jszip-2.5.0,pdfmake-0.1.18,dt-1.10.9,af-2.0.0,b-1.0.3,b-colvis-1.0.3,b-html5-1.0.3,b-print-1.0.3,se-1.0.1/datatables.min.js"></script>
<script type="text/javascript" src="script/script.js"></script>

        <style>
                .top_container
                {
                    display: flex;
                    padding: 15px 20px;
                    font-weight: 700;
                    color: #fff;
                    text-align: center;
                    background-color: #0275d8;
                    #width:100%;
                }
                .middle_container
                {
                    margin-top:1%;
                    #border:2px solid #d8d8e5;
                    #overflow-x:auto;
                }
                .box
                {
                        #border:2px solid #f0f0ff;
                        border:4px solid #f0f0ff;
                        background:#ffffff;
                        //text-align:center;
                        overflow:hidden;
                        padding:0;

                }
                body
                {
                        background:#f0f0ff;
                }
                table
                {
                        width:100%;
                        border:1px solid #f0f0ff;
                        padding:1%;

                }
                .center
                {
                        text-align:center;
                }
                td,th
                {
                        background:#ffffff;
                        text-align:center;
                        padding:5;
                        font-size:12px;

                }

                .avail
                {
                        color:green;

                }
                .not-avail
                {
                        color:red;
                }
                .glyphicon
                {
                        font-size:24px;
                }
                #myTable_wrapper{
                        width:100%;

                }








                 .dataTables_length {
                        margin-top:50px;
                  }
                  div.dt-buttons {
                    position: relative;
                    float: left;
                    margin-left: 20px;
                    margin-top:12px;
                    font-size:16px;
                    font-weight:bold;
                    margin-bottom:10px;
                 }
                 .dataTables_filter {
                         margin-top:20px;
                 }
                 .buttons-html5{
                        width:100%;
                }



        </style>

        <body>
                <div class="container top_container">
                        hello PROD Compliance Monitoring
                        <a href="data/service_status.csv" style="color:white;margin-right:0px;margin-left:auto;"> Download </a>
                </div>

                <marquee direction="left" style="margin-top:1%;font-size: 150%;">
                        The data on this Portal is updated on an hourly basis.
                </marquee>


                <div class="container-fluid middle_container" style="text-align:center;width:95%;">
                        <div class="row">
                                <div class="col-sm-1o" id="data">
                                        <!--<table id="myTable">
                                        </table> -->
                                </div>


                        </div>



                </div>
















                <script>

      document.addEventListener("DOMContentLoaded",async ()=> {
var uid=localStorage.getItem('uidd')
var password=localStorage.getItem('password')
  try{
     const response  = await fetch('https://10.191.171.12:5443/PyPortal/EISHome/authenticatePortal/',{
     method:'POST',
     headers:{
             'Content-Type':'application/json',
    },
    body: JSON.stringify({uid,password})
    });
    const data = await response.json();
    if(data.status==302){
            console.log("login successfull")
    }
    else{
          window.location.href='https://10.191.171.12:5443/PyPortal/'
    }
  }
catch(e){
console.log("an error occured for login"+e)

}
});





                        function getData()
                        {

                          function createHeader(tr,table,header_list)
                          {
                                const thead = document.createElement("thead");

                                header_list = ["Server No.","IP Address","File System","Last Updated","Up Time","Server Role","RAM","CPU Core","OS Version","Kernel Version","Kernel Update","Ace Version","MQ Version","Firewall","RPM Count","DS Agent","Splunk","Ragent","Reference ID","System time","eisuser exp","root exp","SOCVA exp","addmitam exp"];
                                for(var i=0; i <= header_list.length-1;i++)
                                {
                                        //console.log(header_list[i]);
                                        const th = document.createElement("th");
                                        th.innerHTML=header_list[i];
                                        th.classList.add("center");
                                        tr.appendChild(th);

                                }

                                thead.appendChild(tr);
                                table.appendChild(thead);


                          }
                          var monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
                          var xhttp = new XMLHttpRequest();
                          xhttp.onreadystatechange = function()
                          {
                                if (this.readyState == 4 && this.status == 200)
                                {
                                        const table = document.createElement("table");
                                        //const table  = document.getElementById("myTable");
                                        const tbody = document.createElement("tbody");
                                        table.setAttribute("border","1");
                                        table.classList.add("table-responsive");
                                        table.classList.add("table-bordered");
                                        table.classList.add("display");

                                        table.setAttribute("id","myTable");
                                        const tr = document.createElement("tr");

                                        createHeader(tr,table);

                                        const data_div = document.getElementById("data");

                                        /*
                                        const tr = document.createElement("tr");
                                        const td = document.createElement("td");
                                        const td1 = document.createElement("td");
                                        const td2 = document.createElement("td");
                                        const td3 = document.createElement("td");

                                        //const td4 = document.createElement("td");
                                        table.setAttribute("border","1");

                                        table.classList.add("table-responsive");
                                        table.classList.add("table-bordered");
                                        //const data_div = document.getElementById("data");

                                        console.log("all ok");
                                        td.innerHTML="&nbsp &nbsp";
                                        td1.innerHTML="DS Agent";
                                        td2.innerHTML="Splunk Status";
                                        td3.innerHTML="Imperva Status";

                                        td.classList.add("center");

                                        td1.classList.add("center");
                                        td2.classList.add("center");

                                        td3.classList.add("center");
                                        tr.appendChild(td);
                                        tr.appendChild(td1);
                                        tr.appendChild(td2);

                                        tr.appendChild(td3);


                                        table.appendChild(tr);*/
                                        //data_div.appendChild(table);

                                        row_data=this.responseText.split("\n");
                                        for (var i = 0; i < row_data.length-1; i++)
                                        {
                                                col=row_data[i].split(",");
                                                col_length = col.length-1
                                                const tr1 = document.createElement("tr");
                                                const td_counter = document.createElement("td");
                                                td_counter.innerHTML=i+1;
                                                tr1.appendChild(td_counter);
                                                for (let j = 0; j <=col_length ;j++ )
                                                {
                                                        //console.log(j," ",col[j]);
                                                        const td_service = document.createElement("td");
                                                        td_service.setAttribute("id",col[j]);
                                                        if( col[j] == "DSrunning" )
                                                        {
                                                                //<span class="glyphicon glyphicon-ok-circle"></span>
                                                                span_element = document.createElement("span");

                                                                span_element.classList.add("glyphicon");
                                                                span_element.classList.add("glyphicon-ok-circle");

                                                                span_element.classList.add("avail");
                                                                td_service.appendChild(span_element);
                                                        }
                                                        else if( col[j] == "DSnotrunning" )
                                                        {
                                                                //<span class="glyphicon glyphicon-ok-circle"></span>
                                                                span_element = document.createElement("span");

                                                                span_element.classList.add("glyphicon");
                                                                span_element.classList.add("glyphicon-remove-circle");
                                                                span_element.classList.add("not-avail");
                                                                td_service.appendChild(span_element);
                                                        }

                                                        else if( col[j] == "SPLrunning" )
                                                        {
                                                                span_element = document.createElement("span");

                                                                span_element.classList.add("glyphicon");
                                                                span_element.classList.add("glyphicon-ok-circle");

                                                                span_element.classList.add("avail");
                                                                td_service.appendChild(span_element);


                                                        }
                                                         else if( col[j] == "SPLnotrunning" )
                                                        {
                                                                //<span class="glyphicon glyphicon-ok-circle"></span>
                                                                span_element = document.createElement("span");

                                                                span_element.classList.add("glyphicon");
                                                                span_element.classList.add("glyphicon-remove-circle");

                                                                span_element.classList.add("not-avail");
                                                                td_service.appendChild(span_element);
                                                        }
                                                        else if( col[j] == "Ragentrunning" )
                                                        {
                                                                span_element = document.createElement("span");

                                                                span_element.classList.add("glyphicon");
                                                                span_element.classList.add("glyphicon-ok-circle");

                                                                span_element.classList.add("avail");
                                                                td_service.appendChild(span_element);


                                                        }
                                                         else if( col[j] == "Ragentnotrunning" )
                                                        {
                                                                //<span class="glyphicon glyphicon-ok-circle"></span>
                                                                span_element = document.createElement("span");

                                                                span_element.classList.add("glyphicon");
                                                                span_element.classList.add("glyphicon-remove-circle");

                                                                span_element.classList.add("not-avail");
                                                                td_service.appendChild(span_element);
                                                        }
                                                        else if ( col[j] == "active" )
                                                        {

                                                                span_element = document.createElement("span");

                                                                span_element.classList.add("glyphicon");
                                                                span_element.classList.add("glyphicon-ok-circle");

                                                                span_element.classList.add("avail");
                                                                td_service.appendChild(span_element);


                                                        }


                                                        else if ( col[j] == "inactive" )
                                                        {

                                                                span_element = document.createElement("span");

                                                                span_element.classList.add("glyphicon");
                                                                span_element.classList.add("glyphicon-remove-circle");

                                                                span_element.classList.add("not-avail");
                                                                td_service.appendChild(span_element);


                                                        }

                                                        else if ( col[j] == "DS_someissue" )
                                                        {

                                                                span_element = document.createElement("span");

                                                                span_element.classList.add("glyphicon");
                                                                span_element.classList.add("glyphicon-ban-circle");

                                                                td_service.appendChild(span_element);


                                                        }


                                                        else if ( col[j] == "SPL_someissue" )
                                                        {

                                                                span_element = document.createElement("span");

                                                                span_element.classList.add("glyphicon");
                                                                span_element.classList.add("glyphicon-ban-circle");

                                                                td_service.appendChild(span_element);


                                                        }







                                                        else if ( col[j] == "undefined" )
                                                        {
                                                                span_element = document.createElement("span");

                                                                span_element.classList.add("glyphicon");
                                                                span_element.classList.add("glyphicon-ban-circle");
                                                                td_service.appendChild(span_element);
                                                        }


                                                        else if ( col[j] == "" )
                                                        {
                                                                //col[j] == "issue while fetching data";
                                                                td_service.innerHTML="issue";
                                                        }

                                                        else
                                                        {
                                                                //<span class="glyphicon glyphicon-remove-circle"></span>
                                                                var foundMonths=monthNames.filter(month => col[j].includes(month));
                                                                if ( foundMonths.length > 0 && j != 9)
                                                                {
                                                                        console.log("month found in",j);
                                                                        const today = new Date();
                                                                        const targetDate=new Date(col[j]);
                                                                        const diffmili=targetDate-today;
                                                                        const diff=Math.round(diffmili/(1000 * 60 * 60 * 24));
                                                                        td_service.innerHTML=col[j];

                                                                        if ( diff <=5 )
                                                                        {
                                                                                td_service.style.backgroundColor="red";
                                                                        }
                                                                        else if ( diff >=6 && diff <=10 )
                                                                        {

                                                                                td_service.style.backgroundColor="orange";
                                                                        }
                                                                        else if ( diff <=11 && diff <=15)
                                                                        {

                                                                                td_service.style.backgroundColor="yellow";


                                                                        }

                                                                }
                                                                else
                                                                {


                                                                        td_service.innerHTML=col[j];
                                                                        //console.log("print case");
                                                                }
                                                        }
                                                        tr1.appendChild(td_service);
                                                        tbody.appendChild(tr1);
                                                }

                                        }
                                        const tfoot = document.createElement("tfoot");
                                        const tr_element = document.createElement("tr");

                                        header_list = ["Server No.","IP Address","File System","Last Updated","Up Time","Server Role","RAM","CPU Core","OS Version","Kernel Version","Kernel Update","Ace Version","MQ Version","Firewall","RPM Count","DS Agent","Splunk","Ragent","Reference ID","System time","eisuser exp","root exp","SOCVA exp","addmitam exp"];
                                        for(var i=0; i <= header_list.length-1;i++)
                                        {
                                                //console.log(header_list[i]);
                                                const th = document.createElement("th");
                                                th.innerHTML=header_list[i];
                                                th.classList.add("center");
                                                tr_element.appendChild(th);

                                        }
                                        tfoot.appendChild(tr_element);




                                        table.appendChild(tbody);
                                         table.appendChild(tfoot);
                                        data_div.appendChild(table);




                                }
                          };
                          let file_name = "data/combine.txt";
                          xhttp.open("GET",file_name, true);
                          xhttp.send();
                          console.log("Table Created");
                        }


                                getData();
                </script>

                 <script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.7.1.js"></script>
                 <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/2.1.4/js/dataTables.js"></script>
                 <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/3.1.1/js/dataTables.buttons.js"></script>
                 <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/3.1.1/js/buttons.dataTables.js"></script>
                 <script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
                 <script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
                 <script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
                 <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/3.1.1/js/buttons.html5.min.js"></script>
                 <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/3.1.1/js/buttons.print.min.js"></script>
                <script type="text/javascript" charset="utf8" src="vendor/datatables-plugins/dataTables.bootstrap.min.js"></script>
                <script type="text/javascript" charset="utf8" src="vendor/datatables-responsive/dataTables.responsive.js"></script>

                <script>
                        $( window ).on("load", function() {


                                initializeDataTable();






                        });



                        function initializeDataTable()
                        {
                                 console.log( "appling data table filter ...." );
                                 var table = $('#myTable').DataTable({


                                        "processing":true,
                                        "pageLength": 10,
                                         dom: 'lBfrtip',




                                        "lengthMenu": [10,25,50,100],
                                        "buttons": [
                                         {
                                                extend: 'collection',
                                                text: 'Export',
                                                buttons: [
                                                    'copy',
                                                    'excel',
                                                    'csv',
                                                ]
                                        }
                                        ]



                                });

                                $("#myTable tfoot th").each( function ( i ) {
                                        var select = $('<select><option value=""></option></select>')
                                            .appendTo( $(this).empty() )
                                            .on( 'change', function () {
                                                table.column( i )
                                                    .search( $(this).val() )
                                                    .draw();
                                    } );

                                table.column( i ).data().unique().sort().each( function ( d, j ) {
                                    select.append( '<option value="'+d+'">'+d+'</option>' )
                                } );
                            } );


                              console.log( "table filter applied  ...." );

                        }


                        $(window).on('beforeunload',function(){

                                initializeDataTable();

                        });






                </script>




        </body>


</html>















